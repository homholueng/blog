---
title: Chapter 19 - 动态属性和特性
categories: 
- Fluent Python
tags:
- Python
---

> 特性至关重要的地方在于，特性的存在使得开发者可以非常安全并且确定可行地将公共数据属性作为类的公共接口的一部分开放出来。

### 19.1.3　使用 `__new__` 方法以灵活的方式创建对象

我们通常把 `__init__` 称为构造方法，这是从其他语言借鉴过来的术语。其实，用于构建实例的是特殊方法 `__new__`：这是个类方法（使用特殊方式处理，因此不必使用 `@classmethod` 装饰器），必须返回一个实例。返回的实例会作为第一个参数（即 self）传给 `__init__` 方法。因为调用 `__init__` 方法时要传入实例，而且禁止返回任何值，所以 `__init__` 方法其实是“初始化方法”。真正的构造方法是 `__new__`。我们几乎不需要自己编写 `__new__` 方法，因为从 object 类继承的实现已经足够了。

刚才说明的过程，即从 `__new__` 方法到 `__init__` 方法，是最常见的，但不是唯一的。`__new__` 方法也可以返回其他类的实例，此时，解释器不会调用 `__init__` 方法。

### 19.1.4 shelve 模块

标准库中有个 shelve（架子）模块，这名字听起来怪怪的，可是如果知道 pickle（泡菜）是 Python 对象序列化格式的名字，还是在那个格式与对象之间相互转换的某个模块的名字，就会觉得以 shelve 命名是合理的。泡菜坛子摆放在架子上，因此 shelve 模块提供了 pickle 存储方式。

`shelve.open` 高阶函数返回一个 `shelve.Shelf` 实例，这是简单的键 值对象数据库，背后由 dbm 模块支持，具有下述特点：

- `shelve.Shelf` 是 `abc.MutableMapping` 的子类，因此提供了处理映射类型的重要方法。
- `shelve.Shelf` 类还提供了几个管理 I/O 的方法，如 sync 和 close；它也是一个上下文管理器。
- 只要把新值赋予键，就会保存键和值。
- 键必须是字符串。
- 值必须是 pickle 模块能处理的对象。

